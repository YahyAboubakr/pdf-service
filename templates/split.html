{% extends "base.html" %}

{% block title %}Diviser PDF - PDF Tools{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-8">
        <h2 class="mb-4"><i class="fas fa-cut"></i> Diviser un PDF</h2>
        
        <form method="POST" enctype="multipart/form-data" id="splitForm">
            <div class="card mb-4">
                <div class="card-header">
                    <h5><i class="fas fa-file-upload"></i> Sélectionner le fichier PDF</h5>
                </div>
                <div class="card-body">
                    <div class="drop-zone mb-3" id="dropZone">
                        <i class="fas fa-cloud-upload-alt fa-2x text-muted mb-2"></i>
                        <h5>Glissez-déposez votre fichier PDF ici</h5>
                        <p>ou cliquez pour sélectionner</p>
                        <input type="file" name="file" accept=".pdf" class="d-none" id="fileInput" required>
                    </div>
                    
                    <div id="fileInfo" class="alert alert-info d-none">
                        <i class="fas fa-file-pdf text-danger"></i>
                        <span id="fileName"></span>
                        <span id="fileSize" class="text-muted"></span>
                    </div>
                </div>
            </div>

            <div class="card mb-4">
                <div class="card-header">
                    <h5><i class="fas fa-cogs"></i> Options de division</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <div class="card h-100 option-card" data-option="single">
                                <div class="card-body text-center">
                                    <i class="fas fa-file fa-2x text-info mb-2"></i>
                                    <h6>Pages individuelles</h6>
                                    <p class="small text-muted">Une page par fichier PDF</p>
                                    <input type="radio" name="split_option" value="single" class="form-check-input" id="single">
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-4 mb-3">
                            <div class="card h-100 option-card" data-option="range">
                                <div class="card-body text-center">
                                    <i class="fas fa-layer-group fa-2x text-success mb-2"></i>
                                    <h6>Par intervalles</h6>
                                    <p class="small text-muted">Diviser toutes les N pages</p>
                                    <input type="radio" name="split_option" value="range" class="form-check-input" id="range">
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-4 mb-3">
                            <div class="card h-100 option-card" data-option="pages">
                                <div class="card-body text-center">
                                    <i class="fas fa-list-ol fa-2x text-warning mb-2"></i>
                                    <h6>Pages spécifiques</h6>
                                    <p class="small text-muted">Choisir les pages à extraire</p>
                                    <input type="radio" name="split_option" value="pages" class="form-check-input" id="pages">
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Options spécifiques -->
                    <div id="rangeOptions" class="mt-3 d-none">
                        <label for="pages_per_file" class="form-label">Nombre de pages par fichier :</label>
                        <input type="number" name="pages_per_file" class="form-control" id="pages_per_file" value="1" min="1">
                    </div>
                    
                    <div id="pagesOptions" class="mt-3 d-none">
                        <label for="pages" class="form-label">Pages à extraire :</label>
                        <input type="text" name="pages" class="form-control" id="pagesInput" 
                               placeholder="Ex: 1,3,5-7,10 ou 2-5">
                        <div class="form-text">
                            Format accepté : numéros séparés par des virgules, intervalles avec des tirets (ex: 1,3,5-7)
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="text-center">
                <button type="submit" class="btn btn-info btn-lg" id="splitBtn" disabled>
                    <i class="fas fa-cut"></i> Diviser le PDF
                </button>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const dropZone = document.getElementById('dropZone');
    const fileInput = document.getElementById('fileInput');
    const fileInfo = document.getElementById('fileInfo');
    const fileName = document.getElementById('fileName');
    const fileSize = document.getElementById('fileSize');
    const splitBtn = document.getElementById('splitBtn');
    const optionCards = document.querySelectorAll('.option-card');
    const rangeOptions = document.getElementById('rangeOptions');
    const pagesOptions = document.getElementById('pagesOptions');
    
    let selectedFile = null;

    // Styles pour les cartes d'options
    const style = document.createElement('style');
    style.textContent = `
        .option-card {
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid #dee2e6;
        }
        .option-card:hover {
            border-color: #007bff;
            box-shadow: 0 4px 8px rgba(0,123,255,0.2);
        }
        .option-card.selected {
            border-color: #007bff;
            background-color: #f8f9fa;
        }
        .option-card input[type="radio"] {
            display: none;
        }
    `;
    document.head.appendChild(style);

    // Click pour ouvrir le sélecteur
    dropZone.addEventListener('click', () => fileInput.click());

    // Drag & Drop
    dropZone.addEventListener('dragover', (e) => {
        e.preventDefault();
        dropZone.classList.add('dragover');
    });

    dropZone.addEventListener('dragleave', () => {
        dropZone.classList.remove('dragover');
    });

    dropZone.addEventListener('drop', (e) => {
        e.preventDefault();
        dropZone.classList.remove('dragover');
        if (e.dataTransfer.files.length > 0) {
            handleFile(e.dataTransfer.files[0]);
        }
    });

    fileInput.addEventListener('change', (e) => {
        if (e.target.files.length > 0) {
            handleFile(e.target.files[0]);
        }
    });

    function handleFile(file) {
        if (file.type === 'application/pdf') {
            selectedFile = file;
            fileName.textContent = file.name;
            fileSize.textContent = ` (${formatFileSize(file.size)})`;
            fileInfo.classList.remove('d-none');
            updateSplitButton();
        } else {
            alert('Veuillez sélectionner un fichier PDF');
        }
    }

    // Gestion des options de division
    optionCards.forEach(card => {
        card.addEventListener('click', function() {
            const option = this.dataset.option;
            const radio = this.querySelector('input[type="radio"]');
            
            // Déselectionner toutes les cartes
            optionCards.forEach(c => c.classList.remove('selected'));
            
            // Sélectionner la carte cliquée
            this.classList.add('selected');
            radio.checked = true;
            
            // Afficher/masquer les options spécifiques
            rangeOptions.classList.add('d-none');
            pagesOptions.classList.add('d-none');
            
            if (option === 'range') {
                rangeOptions.classList.remove('d-none');
            } else if (option === 'pages') {
                pagesOptions.classList.remove('d-none');
            }
            
            updateSplitButton();
        });
    });

    function updateSplitButton() {
        const hasFile = selectedFile !== null;
        const hasOption = document.querySelector('input[name="split_option"]:checked') !== null;
        splitBtn.disabled = !(hasFile && hasOption);
    }

    function formatFileSize(bytes) {
        if (bytes === 0) return '0 Bytes';
        const k = 1024;
        const sizes = ['Bytes', 'KB', 'MB', 'GB'];
        const i = Math.floor(Math.log(bytes) / Math.log(k));
        return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
    }
    
    // Validation du formulaire
    document.getElementById('splitForm').addEventListener('submit', function(e) {
        const selectedOption = document.querySelector('input[name="split_option"]:checked');
        
        if (selectedOption && selectedOption.value === 'pages') {
            const pagesInput = document.getElementById('pagesInput').value.trim();
            if (!pagesInput) {
                e.preventDefault();
                alert('Veuillez spécifier les pages à extraire');
                return false;
            }
        }
        
        if (selectedOption && selectedOption.value === 'range') {
            const pagesPerFile = parseInt(document.getElementById('pages_per_file').value);
            if (pagesPerFile < 1) {
                e.preventDefault();
                alert('Le nombre de pages par fichier doit être supérieur à 0');
                return false;
            }
        }
    });
});
</script>
{% endblock %}
"""